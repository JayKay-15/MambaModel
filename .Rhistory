home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
# check for extreme correlation
cor_mx <- cor(cor_df)
extreme_cor <- sum(abs(cor_mx[upper.tri(cor_mx)]) > .999)
extreme_cor
summary(cor_mx[upper.tri(cor_mx)])
# find highly correlated features
cor_cols <- findCorrelation(cor_mx, cutoff = .5, exact = F, names = T)
cor_cols
# filter highly correlated features
cor_df_new <- cor_df %>% select(-all_of(cor_cols))
# check new set of features for correlation
cor_mx_new <- cor(cor_df_new)
findCorrelation(cor_mx_new, cutoff = .5)
summary(cor_mx_new[upper.tri(cor_mx_new)])
# correlations - win
model_win_all <- nba_final %>%
select(team_winner, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace) %>%
mutate(team_winner = if_else(team_winner == "win", 1, 0))
# near zero variables
nearZeroVar(model_win_all, saveMetrics = T)
# filter highly correlated features
model_win <- model_win_all %>% select(-all_of(cor_cols))
# correlations - all variables
cor_mx <- cor(model_win_all, model_win_all$team_winner)
cor_mx <- as.matrix(cor_mx[order(abs(cor_mx[,1]), decreasing = T),])
cor_mx
# correlations - filtered variables
cor_mx <- cor(model_win, model_win$team_winner)
cor_mx <- as.matrix(cor_mx[order(abs(cor_mx[,1]), decreasing = T),])
cor_mx
# correlations - team score
model_ts_all <- nba_final %>%
select(team_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
# near zero variables
nearZeroVar(model_ts_all, saveMetrics = T)
# filter highly correlated features
model_ts <- model_ts_all %>% select(-all_of(cor_cols))
# correlations - all variables
cor_mx <- cor(model_ts_all, model_ts_all$team_score)
cor_mx <- as.matrix(cor_mx[order(abs(cor_mx[,1]), decreasing = T),])
cor_mx
# correlations - filtered variables
cor_mx <- cor(model_ts, model_ts$team_score)
cor_mx <- as.matrix(cor_mx[order(abs(cor_mx[,1]), decreasing = T),])
cor_mx
# correlations - opp score
model_os_all <- nba_final %>%
select(opp_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
# near zero variables
nearZeroVar(model_os_all, saveMetrics = T)
# filter highly correlated features
model_os <- model_os_all %>% select(-all_of(cor_cols))
# correlations - all variables
cor_mx <- cor(model_os_all, model_os_all$opp_score)
cor_mx <- as.matrix(cor_mx[order(abs(cor_mx[,1]), decreasing = T),])
cor_mx
# correlations - filtered variables
cor_mx <- cor(model_os, model_os$opp_score)
cor_mx <- as.matrix(cor_mx[order(abs(cor_mx[,1]), decreasing = T),])
cor_mx
rm(list=ls()[! ls() %in% c("nba_final", "cor_cols")])
# all features
train <- nba_final %>%
filter(season <= 2021) %>%
select(team_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
test <- nba_final %>%
filter(season > 2021) %>%
select(team_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
# highly correlated features removed
train <- train %>% select(-all_of(cor_cols))
test <- test %>% select(-all_of(cor_cols))
# normalize features
pre_proc_val <- preProcess(train[,-1], method = c("center", "scale"))
train[,-1] = predict(pre_proc_val, train[,-1])
test[,-1] = predict(pre_proc_val, test[,-1])
# model
ctrl <- trainControl(method = "cv", number = 5, verboseIter = T)
grid <- expand.grid(
k = seq(2, 50, 2)
)
knn_team <- train(as ~., data = train,
method = "knn",
trControl = ctrl,
tuneGrid = grid)
knn_team <- train(team_score ~., data = train,
method = "knn",
trControl = ctrl,
tuneGrid = grid)
knn_team
summary(knn_team) # model components
plot(knn_team) # viz
# predictions
team_pred <- predict(knn_team, test)
# model evaluation
postResample(pred = team_pred, obs = test$team_score) # caret eval
rmse <- RMSE(team_pred, test$team_score)
mae <- MAE(team_pred, test$team_score)
r2 <- R2(team_pred, test$team_score)
cat("RMSE: ", rmse, "MAE: ", mae, " R2: ", r2)
# variable importance
importance <- varImp(knn_team, scale = F)
print(importance)
plot(importance)
reg_team_imp <- rownames_to_column(importance[["importance"]], "Var") %>%
arrange(desc(Overall)) %>%
head(20)
knn_team_imp
# all features
train <- nba_final %>%
filter(season <= 2021) %>%
select(opp_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
test <- nba_final %>%
filter(season > 2021) %>%
select(opp_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
# all features
train <- nba_final %>%
filter(season <= 2021) %>%
select(opp_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
test <- nba_final %>%
filter(season > 2021) %>%
select(opp_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
# highly correlated features removed
train <- train %>% select(-all_of(cor_cols))
test <- test %>% select(-all_of(cor_cols))
# normalize features
pre_proc_val <- preProcess(train[,-1], method = c("center", "scale"))
train[,-1] = predict(pre_proc_val, train[,-1])
test[,-1] = predict(pre_proc_val, test[,-1])
# model
ctrl <- trainControl(method = "cv", number = 5, verboseIter = T)
grid <- expand.grid(
k = seq(2, 50, 2)
)
knn_opp <- train(opp_score ~., data = train,
method = "knn",
trControl = ctrl,
tuneGrid = grid)
knn_opp
summary(knn_opp) # model components
plot(knn_opp) # viz
# predictions
team_pred <- predict(knn_opp, test)
# model evaluation
postResample(pred = team_pred, obs = test$team_score) # caret eval
# all features
train <- nba_final %>%
filter(season <= 2021) %>%
select(team_winner, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
test <- nba_final %>%
filter(season > 2021) %>%
select(team_winner, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
# highly correlated features removed
train <- train %>% select(-all_of(cor_cols))
test <- test %>% select(-all_of(cor_cols))
# normalize features
pre_proc_val <- preProcess(train[,-1], method = c("center", "scale"))
train[,-1] = predict(pre_proc_val, train[,-1])
test[,-1] = predict(pre_proc_val, test[,-1])
# model
ctrl <- trainControl(method = "cv", number = 5, verboseIter = T,
classProbs = T, summaryFunction = twoClassSummary)
grid <- expand.grid(
.mtry = 1:6,
.splitrule = "gini",
.min.node.size = 1
)
rf_win <- train(as.factor(result) ~., data = train,
method = "ranger",
metric = "ROC",
trControl = ctrl,
tuneGrid = grid)
rf_win <- train(team_winner ~., data = train,
method = "ranger",
metric = "ROC",
trControl = ctrl,
tuneGrid = grid)
rf_win
rf_win$resample
rf_win$results
summary(rf_win) # model components
confusionMatrix(rf_win) # confusion matrix
glance(rf_win$finalModel) # entire model - tidymodels
tidy(rf_win$finalModel) # model components - tidymodels
# predictions
win_pred <- predict(reg_win, test, type = "prob")
# predictions
win_pred <- predict(reg_win, test, type = "prob")
confusionMatrix(test$team_winner,
factor(ifelse(win_pred[,1] > 0.5, "win", "loss"),
levels = c("win","loss")),
positive = "win")
away_pred <- as.numeric(win_pred[,1])
home_pred <- as.numeric(win_pred[,2])
obs <- test$team_winner
pred <- factor(ifelse(away_pred > 0.5, "win", "loss"), levels = c("win","loss"))
obs_pred <- data.frame(obs = obs,
pred = pred,
win = away_pred,
loss = home_pred)
# model evaluation
twoClassSummary(obs_pred, lev = levels(obs)) # roc
# predictions
win_pred <- predict(rf_win, test, type = "prob")
confusionMatrix(test$team_winner,
factor(ifelse(win_pred[,1] > 0.5, "win", "loss"),
levels = c("win","loss")),
positive = "win")
away_pred <- as.numeric(win_pred[,1])
home_pred <- as.numeric(win_pred[,2])
obs <- test$team_winner
pred <- factor(ifelse(away_pred > 0.5, "win", "loss"), levels = c("win","loss"))
obs_pred <- data.frame(obs = obs,
pred = pred,
win = away_pred,
loss = home_pred)
# model evaluation
twoClassSummary(obs_pred, lev = levels(obs)) # roc
prSummary(obs_pred, lev = levels(obs)) # auc
mnLogLoss(obs_pred, lev = levels(obs)) # log loss
eval <- MLeval::evalm(data.frame(win_pred, test$team_winner)) # roc chart
roc_score <- pROC::roc(test$team_winner, away_pred, plot = T, legacy.axes = T,
percent = T,
xlab="False Positive Percentage",
ylab="True Postive Percentage",
col="#377eb8", lwd = 4, print.auc = T) # roc chart
postResample(pred = pred, obs = obs) # caret eval
obs_pred %>% metrics(obs, pred) # accuracy and kappa
obs_pred %>% roc_auc(obs, win) # auc
# feature importance
importance <- varImp(reg_win, scale = F)
# feature importance
importance <- varImp(rf_win, scale = F)
postResample(pred = pred, obs = obs) # caret eval
obs_pred %>% metrics(obs, pred) # accuracy and kappa
obs_pred %>% roc_auc(obs, win) # auc
# all features
train <- nba_final %>%
filter(season <= 2021) %>%
select(team_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
# all features
train <- nba_final %>%
filter(season <= 2021) %>%
select(team_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
test <- nba_final %>%
filter(season > 2021) %>%
select(team_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
# highly correlated features removed
train <- train %>% select(-all_of(cor_cols))
test <- test %>% select(-all_of(cor_cols))
# normalize features
pre_proc_val <- preProcess(train[,-1], method = c("center", "scale"))
train[,-1] = predict(pre_proc_val, train[,-1])
test[,-1] = predict(pre_proc_val, test[,-1])
# model
ctrl <- trainControl(method = "cv", number = 5, verboseIter = T)
grid <- expand.grid(
.mtry = seq(2, 18, 2),
.splitrule = "variance",
.min.node.size = 1
)
rf_as <- train(team_score ~., data = train,
method = "ranger",
trControl = ctrl,
tuneGrid = grid)
rf_team
rf_team <- train(team_score ~., data = train,
method = "ranger",
trControl = ctrl,
tuneGrid = grid)
rf_team
rf_team$resample
rf_team$results
summary(rf_team) # model components
autoplot(rf_team$finalModel) # viz - ggfortify
glance(rf_team$finalModel) # entire model - tidymodels
tidy(rf_team$finalModel) # model components - tidymodels
plot(rf_team$finalModel) # viz
plot(rf_team) # viz
# predictions
team_pred <- predict(rf_team, test)
# model evaluation
postResample(pred = team_pred, obs = test$team_score) # caret eval
rmse <- RMSE(team_pred, test$team_score)
mae <- MAE(team_pred, test$team_score)
r2 <- R2(team_pred, test$team_score)
cat("RMSE: ", rmse, "MAE: ", mae, " R2: ", r2)
# variable importance
importance <- varImp(rf_team, scale = F)
# all features
train <- nba_final %>%
filter(season <= 2021) %>%
select(opp_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
test <- nba_final %>%
filter(season > 2021) %>%
select(opp_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
# highly correlated features removed
train <- train %>% select(-all_of(cor_cols))
test <- test %>% select(-all_of(cor_cols))
# normalize features
pre_proc_val <- preProcess(train[,-1], method = c("center", "scale"))
train[,-1] = predict(pre_proc_val, train[,-1])
test[,-1] = predict(pre_proc_val, test[,-1])
# model
ctrl <- trainControl(method = "cv", number = 5, verboseIter = T)
grid <- expand.grid(
alpha = 0,
lambda = 10^seq(2, -3, by = -.1)
)
# model
ctrl <- trainControl(method = "cv", number = 5, verboseIter = T)
# all features
train <- nba_final %>%
filter(season <= 2021) %>%
select(opp_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
test <- nba_final %>%
filter(season > 2021) %>%
select(opp_score, away_implied_prob,
b2b_first:opp_b2b_second,
away_fg2m:away_fg3_pct,
away_fgm:away_opp_fg3_pct,
away_opp_fgm:away_opp_ftr,
away_opp_ast:away_pace,
home_fg2m:home_fg3_pct,
home_fgm:home_opp_fg3_pct,
home_opp_fgm:home_opp_ftr,
home_opp_ast:home_pace)
# highly correlated features removed
train <- train %>% select(-all_of(cor_cols))
test <- test %>% select(-all_of(cor_cols))
# normalize features
pre_proc_val <- preProcess(train[,-1], method = c("center", "scale"))
train[,-1] = predict(pre_proc_val, train[,-1])
test[,-1] = predict(pre_proc_val, test[,-1])
# model
ctrl <- trainControl(method = "cv", number = 5, verboseIter = T)
grid <- expand.grid(
.mtry = seq(2, 18, 2),
.splitrule = "variance",
.min.node.size = 1
)
rf_team <- train(opp_score ~., data = train,
method = "ranger",
trControl = ctrl,
tuneGrid = grid)
rf_opp
rf_opp <- train(opp_score ~., data = train,
method = "ranger",
trControl = ctrl,
tuneGrid = grid)
rf_opp
rf_opp$resample
rf_opp$results
plot(rf_opp) # viz
# predictions
opp_pred <- predict(rf_opp, test)
# model evaluation
postResample(pred = opp_pred, obs = test$opp_score) # caret eval
