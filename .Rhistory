b2b_first, opp_b2b_first, b2b_second, opp_b2b_second,
game_count, opp_game_count, mins, team_score, opp_score,
fg2m:pf, opp_fg2m:opp_pf)
# league averages
nba_league_avg <- box_scores_gbg %>%
arrange(game_date, game_id) %>%
group_by(season, team_loc) %>%
summarize(across(mins:opp_pf, \(x) mean(x))) %>%
ungroup() %>%
mutate(
poss = round(fga - oreb + tov + (0.44*fta), 0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44*opp_fta), 0),
pace = round((poss + opp_poss)*48 / ((mins/5)*2), 0),
off_rtg = round((team_score/poss)*100, 1),
def_rtg = round((opp_score/opp_poss)*100, 1),
net_rtg = off_rtg - def_rtg,
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
ast_tov_pct = ast/tov,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
pf_pct = pf/(poss+oppp_poss),
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_ast_tov_pct = opp_ast/opp_tov,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a),
opp_pf_pct = opp_pf/(poss+oppp_poss),
) %>%
select(
season,team_loc,fg2m,fg2a,fg2_pct,fg2_sr,fg3m,fg3a,fg3_pct,fg3_sr,
fgm,fga,fg_pct,efg_pct,ts_pct,ftm,fta,ft_pct,ftr,oreb,oreb_pct,
dreb,dreb_pct,treb,treb_pct,ast,ast_pct,tov,tov_pct,ast_tov_pct,
stl,stl_pct,blk,blk_pct,pf,pf_pct,
opp_fg2m,opp_fg2a,opp_fg2_pct,opp_fg2_sr,opp_fg3m,opp_fg3a,
opp_fg3_pct,opp_fg3_sr,opp_fgm,opp_fga,opp_fg_pct,opp_efg_pct,
opp_ts_pct,opp_ftm,opp_fta,opp_ft_pct,opp_ftr,opp_oreb,opp_oreb_pct,
opp_dreb,opp_dreb_pct,opp_treb,opp_treb_pct,opp_ast,opp_ast_pct,
opp_tov,opp_tov_pct,opp_ast_tov_pct,opp_stl,opp_stl_pct,
opp_blk,opp_blk_pct,opp_pf,opp_pf_pct,
poss,opp_poss,pace,off_rtg,def_rtg,net_rtg
)
# league averages
nba_league_avg <- box_scores_gbg %>%
arrange(game_date, game_id) %>%
group_by(season, team_loc) %>%
summarize(across(mins:opp_pf, \(x) mean(x))) %>%
ungroup() %>%
mutate(
poss = round(fga - oreb + tov + (0.44*fta), 0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44*opp_fta), 0),
pace = round((poss + opp_poss)*48 / ((mins/5)*2), 0),
off_rtg = round((team_score/poss)*100, 1),
def_rtg = round((opp_score/opp_poss)*100, 1),
net_rtg = off_rtg - def_rtg,
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
ast_tov_pct = ast/tov,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
pf_pct = pf/(poss+opp_poss),
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_ast_tov_pct = opp_ast/opp_tov,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a),
opp_pf_pct = opp_pf/(poss+opp_poss),
) %>%
select(
season,team_loc,fg2m,fg2a,fg2_pct,fg2_sr,fg3m,fg3a,fg3_pct,fg3_sr,
fgm,fga,fg_pct,efg_pct,ts_pct,ftm,fta,ft_pct,ftr,oreb,oreb_pct,
dreb,dreb_pct,treb,treb_pct,ast,ast_pct,tov,tov_pct,ast_tov_pct,
stl,stl_pct,blk,blk_pct,pf,pf_pct,
opp_fg2m,opp_fg2a,opp_fg2_pct,opp_fg2_sr,opp_fg3m,opp_fg3a,
opp_fg3_pct,opp_fg3_sr,opp_fgm,opp_fga,opp_fg_pct,opp_efg_pct,
opp_ts_pct,opp_ftm,opp_fta,opp_ft_pct,opp_ftr,opp_oreb,opp_oreb_pct,
opp_dreb,opp_dreb_pct,opp_treb,opp_treb_pct,opp_ast,opp_ast_pct,
opp_tov,opp_tov_pct,opp_ast_tov_pct,opp_stl,opp_stl_pct,
opp_blk,opp_blk_pct,opp_pf,opp_pf_pct,
poss,opp_poss,pace,off_rtg,def_rtg,net_rtg
)
# weighted straight average
nba_avg <- box_scores_gbg %>%
arrange(game_date, game_id) %>%
group_by(season, team_id, team_name, team_loc) %>%
summarize(across(c(mins:opp_score, fg2m:opp_pf),
\(x) mean(x))) %>%
ungroup() %>%
mutate(
poss = round(fga - oreb + tov + (0.44*fta), 0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44*opp_fta), 0),
pace = round((poss + opp_poss)*48 / ((mins/5)*2), 0),
off_rtg = round((team_score/poss)*100, 1),
def_rtg = round((opp_score/opp_poss)*100, 1),
net_rtg = off_rtg - def_rtg,
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
ast_tov_pct = ast/tov,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
pf_pct = pf/(poss+opp_poss),
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_ast_tov_pct = opp_ast/opp_tov,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a),
opp_pf_pct = opp_pf/(poss+opp_poss),
) %>%
select(
season,team_id,team_name,team_loc,
fg2m,fg2a,fg2_pct,fg2_sr,fg3m,fg3a,fg3_pct,fg3_sr,
fgm,fga,fg_pct,efg_pct,ts_pct,ftm,fta,ft_pct,ftr,oreb,oreb_pct,
dreb,dreb_pct,treb,treb_pct,ast,ast_pct,tov,tov_pct,ast_tov_pct,
stl,stl_pct,blk,blk_pct,pf,pf_pct,
opp_fg2m,opp_fg2a,opp_fg2_pct,opp_fg2_sr,opp_fg3m,opp_fg3a,
opp_fg3_pct,opp_fg3_sr,opp_fgm,opp_fga,opp_fg_pct,opp_efg_pct,
opp_ts_pct,opp_ftm,opp_fta,opp_ft_pct,opp_ftr,opp_oreb,opp_oreb_pct,
opp_dreb,opp_dreb_pct,opp_treb,opp_treb_pct,opp_ast,opp_ast_pct,
opp_tov,opp_tov_pct,opp_ast_tov_pct,opp_stl,opp_stl_pct,
opp_blk,opp_blk_pct,opp_pf,opp_pf_pct,
poss,opp_poss,pace,off_rtg,def_rtg,net_rtg
)
# weighted moving average
nba_wt_avg <- box_scores_gbg %>%
arrange(game_date, game_id) %>%
group_by(season, team_id, team_loc) %>%
mutate(across(c(mins:opp_score, fg2m:opp_pf),
\(x) pracma::movavg(x, n = 10, type = 'e'))) %>%
ungroup()
# base columns for final data frame
nba_base <- box_scores_gbg %>%
filter(team_loc == "away") %>%
left_join(odds_df %>% select(-hoopr_id),
by = c("game_id" = "statr_id")) %>%
select(game_id:opp_score, away_spread:home_implied_prob)
# lagged away stats
nba_lag_away <- nba_wt_avg %>%
filter(team_loc == "away") %>%
select(game_id, team_id, mins:opp_score, fg2m:opp_pf) %>%
mutate(
poss = round(fga - oreb + tov + (0.44*fta), 0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44*opp_fta), 0),
pace = round((poss + opp_poss)*48 / ((mins/5)*2), 0),
off_rtg = round((team_score/poss)*100, 1),
def_rtg = round((opp_score/opp_poss)*100, 1),
net_rtg = off_rtg - def_rtg,
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
ast_tov_pct = ast/tov,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
pf_pct = pf/(poss+opp_poss),
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_ast_tov_pct = opp_ast/opp_tov,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a),
opp_pf_pct = opp_pf/(poss+opp_poss),
) %>%
select(
game_id,team_id,fg2m,fg2a,fg2_pct,fg2_sr,fg3m,fg3a,fg3_pct,fg3_sr,
fgm,fga,fg_pct,efg_pct,ts_pct,ftm,fta,ft_pct,ftr,oreb,oreb_pct,
dreb,dreb_pct,treb,treb_pct,ast,ast_pct,tov,tov_pct,ast_tov_pct,
stl,stl_pct,blk,blk_pct,pf,pf_pct,
opp_fg2m,opp_fg2a,opp_fg2_pct,opp_fg2_sr,opp_fg3m,opp_fg3a,
opp_fg3_pct,opp_fg3_sr,opp_fgm,opp_fga,opp_fg_pct,opp_efg_pct,
opp_ts_pct,opp_ftm,opp_fta,opp_ft_pct,opp_ftr,opp_oreb,opp_oreb_pct,
opp_dreb,opp_dreb_pct,opp_treb,opp_treb_pct,opp_ast,opp_ast_pct,
opp_tov,opp_tov_pct,opp_ast_tov_pct,opp_stl,opp_stl_pct,
opp_blk,opp_blk_pct,opp_pf,opp_pf_pct,
poss,opp_poss,pace,off_rtg,def_rtg,net_rtg
) %>%
rename_with(~paste0("away_", .), -c(game_id, team_id)) %>%
group_by(team_id) %>%
mutate(across(away_fg2m:away_net_rtg, \(x) lag(x, n = 1))) %>%
ungroup()
# lagged home stats
nba_lag_home <- nba_wt_avg %>%
filter(team_loc == "home") %>%
select(game_id, team_id, mins:opp_score, fg2m:opp_pf) %>%
mutate(
poss = round(fga - oreb + tov + (0.44*fta), 0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44*opp_fta), 0),
pace = round((poss + opp_poss)*48 / ((mins/5)*2), 0),
off_rtg = round((team_score/poss)*100, 1),
def_rtg = round((opp_score/opp_poss)*100, 1),
net_rtg = off_rtg - def_rtg,
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
ast_tov_pct = ast/tov,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
pf_pct = pf/(poss+opp_poss),
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_ast_tov_pct = opp_ast/opp_tov,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a),
opp_pf_pct = opp_pf/(poss+opp_poss),
) %>%
select(
game_id,team_id,fg2m,fg2a,fg2_pct,fg2_sr,fg3m,fg3a,fg3_pct,fg3_sr,
fgm,fga,fg_pct,efg_pct,ts_pct,ftm,fta,ft_pct,ftr,oreb,oreb_pct,
dreb,dreb_pct,treb,treb_pct,ast,ast_pct,tov,tov_pct,ast_tov_pct,
stl,stl_pct,blk,blk_pct,pf,pf_pct,
opp_fg2m,opp_fg2a,opp_fg2_pct,opp_fg2_sr,opp_fg3m,opp_fg3a,
opp_fg3_pct,opp_fg3_sr,opp_fgm,opp_fga,opp_fg_pct,opp_efg_pct,
opp_ts_pct,opp_ftm,opp_fta,opp_ft_pct,opp_ftr,opp_oreb,opp_oreb_pct,
opp_dreb,opp_dreb_pct,opp_treb,opp_treb_pct,opp_ast,opp_ast_pct,
opp_tov,opp_tov_pct,opp_ast_tov_pct,opp_stl,opp_stl_pct,
opp_blk,opp_blk_pct,opp_pf,opp_pf_pct,
poss,opp_poss,pace,off_rtg,def_rtg,net_rtg
) %>%
rename_with(~paste0("home_", .), -c(game_id, team_id)) %>%
group_by(team_id) %>%
mutate(across(home_fg2m:home_net_rtg, \(x) lag(x, n = 1))) %>%
ungroup()
# final data frame
nba_final <- nba_base %>%
left_join(nba_lag_away, by = c("game_id" = "game_id",
"team_id" = "team_id")) %>%
left_join(nba_lag_home, by = c("game_id" = "game_id",
"opp_id" = "team_id")) %>%
na.exclude() %>%
select(-c(game_count:opp_score)) %>%
arrange(game_date, game_id)
# clear environment
rm(list=ls()[! ls() %in% c("box_scores_gbg", "nba_final",
"nba_league_avg", "nba_avg")])
View(nba_avg)
# weighted straight average
nba_team_avg <- box_scores_gbg %>%
arrange(game_date, game_id) %>%
group_by(season, team_id, team_name, team_loc) %>%
summarize(across(c(mins:opp_score, fg2m:opp_pf),
\(x) mean(x))) %>%
ungroup() %>%
mutate(
poss = round(fga - oreb + tov + (0.44*fta), 0),
opp_poss = round(opp_fga - opp_oreb + opp_tov + (0.44*opp_fta), 0),
pace = round((poss + opp_poss)*48 / ((mins/5)*2), 0),
off_rtg = round((team_score/poss)*100, 1),
def_rtg = round((opp_score/opp_poss)*100, 1),
net_rtg = off_rtg - def_rtg,
fg2_pct = fg2m/fg2a,
fg2_sr = (fga-fg2a)/fga,
fg3_pct = fg3m/fg3a,
fg3_sr = (fga-fg3a)/fga,
fg_pct = fgm/fga,
efg_pct = (fg3m*0.5 + fgm)/fga,
ts_pct = team_score/(fga*2 + fta*0.44),
ft_pct = ftm/fta,
ftr = ftm/fga,
oreb_pct = oreb/(oreb+opp_dreb),
dreb_pct = dreb/(dreb+opp_oreb),
treb_pct = treb/(treb+opp_treb),
ast_pct = ast/fgm,
tov_pct = tov/poss,
ast_tov_pct = ast/tov,
stl_pct = stl/opp_poss,
blk_pct = blk/(opp_fga-opp_fg3a),
pf_pct = pf/(poss+opp_poss),
opp_fg2_pct = opp_fg2m/opp_fg2a,
opp_fg2_sr = (opp_fga-opp_fg2a)/opp_fga,
opp_fg3_pct = opp_fg3m/opp_fg3a,
opp_fg3_sr = (opp_fga-opp_fg3a)/opp_fga,
opp_fg_pct = opp_fgm/opp_fga,
opp_efg_pct = (opp_fg3m*0.5 + opp_fgm)/opp_fga,
opp_ts_pct = opp_score/(opp_fga*2 + opp_fta*0.44),
opp_ft_pct = opp_ftm/opp_fta,
opp_ftr = opp_ftm/opp_fga,
opp_oreb_pct = opp_oreb/(opp_oreb+dreb),
opp_dreb_pct = opp_dreb/(opp_dreb+oreb),
opp_treb_pct = opp_treb/(treb+opp_treb),
opp_ast_pct = opp_ast/opp_fgm,
opp_tov_pct = opp_tov/opp_poss,
opp_ast_tov_pct = opp_ast/opp_tov,
opp_stl_pct = opp_stl/poss,
opp_blk_pct = opp_blk/(fga-fg3a),
opp_pf_pct = opp_pf/(poss+opp_poss),
) %>%
select(
season,team_id,team_name,team_loc,
fg2m,fg2a,fg2_pct,fg2_sr,fg3m,fg3a,fg3_pct,fg3_sr,
fgm,fga,fg_pct,efg_pct,ts_pct,ftm,fta,ft_pct,ftr,oreb,oreb_pct,
dreb,dreb_pct,treb,treb_pct,ast,ast_pct,tov,tov_pct,ast_tov_pct,
stl,stl_pct,blk,blk_pct,pf,pf_pct,
opp_fg2m,opp_fg2a,opp_fg2_pct,opp_fg2_sr,opp_fg3m,opp_fg3a,
opp_fg3_pct,opp_fg3_sr,opp_fgm,opp_fga,opp_fg_pct,opp_efg_pct,
opp_ts_pct,opp_ftm,opp_fta,opp_ft_pct,opp_ftr,opp_oreb,opp_oreb_pct,
opp_dreb,opp_dreb_pct,opp_treb,opp_treb_pct,opp_ast,opp_ast_pct,
opp_tov,opp_tov_pct,opp_ast_tov_pct,opp_stl,opp_stl_pct,
opp_blk,opp_blk_pct,opp_pf,opp_pf_pct,
poss,opp_poss,pace,off_rtg,def_rtg,net_rtg
)
# clear environment
rm(list=ls()[! ls() %in% c("box_scores_gbg", "nba_final",
"nba_league_avg", "nba_team_avg")])
asc_cols <- names(
nba_avg %>% select(tov,tov_pct,
opp_fg2m:opp_ast_pct,opp_ast_tov_pct:opp_blk_pct)
)
desc_cols <- names(
nba_avg %>% select(fg2m:ast_pct,ast_tov_pct:blk_pct,
opp_tov:opp_tov_pct)
)
ranks <- nba_avg %>%
group_by(season, team_loc) %>%
mutate(across(all_of(asc_cols),
list(rank = ~rank(., ties.method = "min"))),
across(all_of(desc_cols),
list(rank = ~rank(-., ties.method = "min"))))
asc_cols <- names(
nba_team_avg %>% select(tov,tov_pct,
opp_fg2m:opp_ast_pct,opp_ast_tov_pct:opp_blk_pct)
)
desc_cols <- names(
nba_team_avg %>% select(fg2m:ast_pct,ast_tov_pct:blk_pct,
opp_tov:opp_tov_pct)
)
ranks <- nba_team_avg %>%
group_by(season, team_loc) %>%
mutate(across(all_of(asc_cols),
list(rank = ~rank(., ties.method = "min"))),
across(all_of(desc_cols),
list(rank = ~rank(-., ties.method = "min"))))
View(ranks)
rankings <- nba_team_avg %>%
group_by(season, team_loc) %>%
mutate(across(all_of(asc_cols),
list(rank = ~rank(., ties.method = "min"))),
across(all_of(desc_cols),
list(rank = ~rank(-., ties.method = "min"))))
asc_cols <- names(
nba_team_avg %>% select(tov,tov_pct,
opp_fg2m:opp_ast_pct,opp_ast_tov_pct:opp_blk_pct)
)
desc_cols <- names(
nba_team_avg %>% select(fg2m:ast_pct,ast_tov_pct:blk_pct,
opp_tov:opp_tov_pct)
)
rankings <- nba_team_avg %>%
group_by(season, team_loc) %>%
mutate(across(all_of(asc_cols),
list(rank = ~rank(., ties.method = "min"))),
across(all_of(desc_cols),
list(rank = ~rank(-., ties.method = "min"))))
away_rank_asc <- nba_avg %>%
filter(season == 2023 & team_loc == "away") %>%
mutate(across(all_of(asc_cols),
list(rank = ~rank(., ties.method = "min"))))
away_rank_asc <- nba_team_avg %>%
filter(season == 2023 & team_loc == "away") %>%
mutate(across(all_of(asc_cols),
list(rank = ~rank(., ties.method = "min"))))
View(away_rank_asc)
# clear environment
rm(list=ls()[! ls() %in% c("box_scores_gbg", "nba_final",
"nba_league_avg", "nba_team_avg",
"standings", "rankings")])
standings_raw <- standings(seasons = 2023, season_types = c("Regular Season"))
standings <- standings_raw %>%
select("nameTeam","nameConference","nameDivison","recordOverall",
"pctWinTeam","recordLast10","slugStreakCurrent",
"recordAway","recordAwayWinPct",
"recordLast10Away","slugStreakAwayCurrent",
"recordHome","recordHomeWinPct",
"recordLast10Home","slugStreakHomeCurrent",
"rankPlayoffs")
colnames(standings) <- c("team","conference","division","record",
"win_pct","last_10","streak",
"away_record","away_win_pct",
"away_last_10","away_steak",
"home_record", "home_win_pct",
"home_last_10","home_streak",
"conference_rank")
dataGameLogsTeam <- tbl(dbConnect(SQLite(), "../nba_sql_db/nba_db"),
"GameLogsTeam") %>%
collect() %>%
filter(season %in% c(2014:2023))
dataGameLogsTeam <- tbl(dbConnect(SQLite(), "../nba_sql_db/nba_db"),
"GameLogsTeam") %>%
collect()
View(dataGameLogsTeam)
dataGameLogsTeam <- tbl(dbConnect(SQLite(), "../nba_sql_db/nba_db"),
"GameLogsTeam") %>%
collect() %>%
filter(yearSeason %in% c(2014:2023))
rm(list=ls()[! ls() %in% c("box_scores_gbg", "nba_final",
"nba_league_avg", "nba_team_avg",
"standings", "rankings")])
View(nba_final)
